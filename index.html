<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Budget Months</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background: #e3f2fd; font-family: 'Segoe UI', Arial, sans-serif; }
        .month-grid { display: flex; flex-wrap: wrap; gap: 24px; padding: 40px; }
        .month-box {
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 2px 8px rgba(44,62,80,0.07);
            width: 220px;
            height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3em;
            color: #1976d2;
            cursor: pointer;
            transition: box-shadow 0.2s;
            position: relative; /* Added for delete button positioning */
        }
        .month-box:hover { box-shadow: 0 4px 16px rgba(44,62,80,0.15); background: #e0f7fa; }
        .add-btn {
            margin: 40px;
            padding: 16px 32px;
            font-size: 1.2em;
            border-radius: 12px;
        }
        .delete-month-btn {
            position: absolute;
            right: 10px;
            top: 10px;
            color: red;
            background: transparent;
            border: none;
            font-size: 1.2em;
            cursor: pointer;
            z-index: 10;
        }
        .delete-month-btn:hover {
            color: darkred;
        }
    </style>
</head>
<body>
    <h1 class="text-center mt-4 mb-2">Budget Months</h1>
    <div class="month-grid" id="monthGrid"></div>
    <div class="text-center">
        <button class="btn btn-success add-btn" onclick="addNewMonth()">Add New Month</button>
    </div>
    <script>
        // Helper to get month name
        function getMonthName(ym) {
            const [year, month] = ym.split('-');
            const date = new Date(year, month - 1);
            return date.toLocaleString('default', { month: 'long', year: 'numeric' });
        }

        // Load months from localStorage
        let allMonths = JSON.parse(localStorage.getItem('allMonths')) || {};
        if (Object.keys(allMonths).length === 0) {
            // If no months, create August 2025 as default
            allMonths['2025-08'] = { bills: [], moneyIns: [] };
            localStorage.setItem('allMonths', JSON.stringify(allMonths));
        }

        function renderMonths() {
            const grid = document.getElementById('monthGrid');
            grid.innerHTML = '';
            Object.keys(allMonths).sort().forEach(ym => {
                const box = document.createElement('div');
                box.className = 'month-box';
                box.innerText = getMonthName(ym);
                
                // Add delete button
                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'delete-month-btn';
                deleteBtn.innerHTML = 'Ã—';
                deleteBtn.onclick = (e) => {
                    e.stopPropagation(); // Prevent triggering the box click
                    if (confirm(`Delete ${getMonthName(ym)}?`)) {
                        delete allMonths[ym];
                        localStorage.setItem('allMonths', JSON.stringify(allMonths));
                        renderMonths();
                    }
                };
                box.appendChild(deleteBtn);
                
                box.onclick = () => {
                    console.log('Setting activeMonth:', ym);
                    localStorage.setItem('activeMonth', ym);
                    console.log('Immediate verification:', localStorage.getItem('activeMonth'));
                    window.location.href = 'bud.html';
                };
                grid.appendChild(box);
            });
        }

        function addNewMonth() {
            // Find latest month
            const months = Object.keys(allMonths).sort();
            const last = months[months.length - 1];
            const [year, month] = last.split('-').map(Number);
            let nextYear = year, nextMonth = month + 1;
            if (nextMonth > 12) { nextMonth = 1; nextYear++; }
            const nextYm = `${nextYear}-${String(nextMonth).padStart(2, '0')}`;
            // Copy bills, ignore moneyIns
            const prevBills = allMonths[last].bills ? JSON.parse(JSON.stringify(allMonths[last].bills)) : [];
            allMonths[nextYm] = { bills: prevBills, moneyIns: [] };
            localStorage.setItem('allMonths', JSON.stringify(allMonths));
            renderMonths();
        }

        // Initialize the page
        renderMonths();
    </script>
</body>
</html>